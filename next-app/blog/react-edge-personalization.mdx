---
slug: react-edge-personalization
title: React Edge Personalization
date: 2021-04-04
---

Personalization at the edge has historically been a pretty tricky task involving
hacking around your 3rd parties API to hook into the react lifecycle, catching re-renders
and re-apply the personalization.

Today I'm introducing a pattern I have yet to name, but it goes like this:

**SSR / SSG**

- We tag the personalizable content but don't apply any modifications
- If the tagged content is statically recognizable as a class or functional React component leaf node,
  it is included in the edge-render endpoint

**Edge Worker:**

- Retrieve the SSR'd or static origin HTML that's meant for everyone without personalization (cache this)
- Parse the HTML for arias tagged personalizable and read the mbox name and any metadata
- Use mbox names and metadata to retrieve personalizable content / modifications
- Apply modifications to HTML / mbox metadata (use edge-render endpoint, store prop modifications)
- Serve to client

**Client Runtime**

- Hault react hydration at arias tagged personalizagle
- Continue to render static HTML with modifications from edge worker
- Resolve any new runtime JS needed (federated / lazy components, etc...)
- Apply property modifications
- Continue hydration with modifications applied to match modifications from edge worker
- Enjoy Zero FOOC (Flash of Original Content) Personalization!

<PreviewWindow>
  <ReactEdgePersonalizationNextAppPagesIndex />
</PreviewWindow>

more stuff here
